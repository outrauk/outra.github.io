models:

  - name: on_market_events_consolidated
    description: >
      Consolidates the complete chronology of events and status changes across property listings for both sales and 
      rentals. This dataset captures every significant milestone in a listing's lifecycleâ€” from new instructions and 
      price changes to under offer, withdrawn, relisted, exchange, and fall-through events.

      Each record represents a distinct event that can be directly observed or inferred and is tied to a property-agent
      relationship - OUTRA_ID. Each OUTRA_ID represents the full journey of one property through their lifecycle.

      By combining data from differents sources - Zoopla & Rightmove - this consolidated view, provides comprehensive
      visibility into listing activity, enabling analysis of transaction patterns, event frequency.
    tests:
      - test_consolidated_new_instruction:
          key_column: OUTRA_ID
          max_failure_rate: 0.1  # 10% threshold
      - test_consolidated_new_instruction_next:
          key_column: OUTRA_ID
          max_failure_rate: 0.1
      - test_consolidated_price_change_next:
          key_column: OUTRA_ID
          max_failure_rate: 0.1
      - test_consolidated_withdrawn_next:
          key_column: OUTRA_ID
          max_failure_rate: 0.11
      - test_consolidated_under_offer_next:
          key_column: OUTRA_ID
          max_failure_rate: 0.1
      - test_consolidated_relisted_next:
          key_column: OUTRA_ID
          max_failure_rate: 0.1
      - test_consolidated_exchange_next:
          key_column: OUTRA_ID
          max_failure_rate: 0.1
      - test_count_events:
          event: EXCHANGE
          transaction_type: SALE
      - test_count_events:
          event: EXCHANGE
          transaction_type: RENT
      - test_count_events:
          event: WITHDRAWN
          transaction_type: SALE
      - test_count_events:
          event: WITHDRAWN
          transaction_type: RENT
      - test_count_events:
          event: NEW_INSTRUCTION
          transaction_type: SALE
      - test_count_events:
          event: NEW_INSTRUCTION
          transaction_type: RENT
      - test_count_events:
          event: PRICE_CHANGE
          transaction_type: SALE
      - test_count_events:
          event: PRICE_CHANGE
          transaction_type: RENT
      - test_count_events:
          event: UNDER_OFFER
          transaction_type: SALE
      - test_count_events:
          event: UNDER_OFFER
          transaction_type: RENT
      - test_count_events:
          event: RELISTED
          transaction_type: SALE
      - test_count_events:
          event: RELISTED
          transaction_type: RENT
      - test_count_events:
          event: FALL_THROUGH
          transaction_type: SALE
      - test_count_events:
          event: FALL_THROUGH
          transaction_type: RENT
    columns:
      - name: OUTRA_ID
        description: Outra identifier of a listing, being that the combination of a property and agent per lifecycle.
      - name: UPRN
        description: Unique Property Identifier.
      - name: TRANSACTION_TYPE
        description: Indicates whether the listing is for sale or rent.
      - name: EVENT_DATE
        description: Date when the event occurred.
      - name: EVENT_TYPE
        description: Type of event (e.g., price change, status update).
      - name: EVENT_INFERRED
        description: Weather the event was inferred or observed.
      - name: PRICE
        description: Price of the listing on the event date.
      - name: AGENT_BRANCH
        description: Agent responsible for the related listing.
      - name: INSERT_DATE
        description: Date when the event was recorded in the database.
      - name: LOAD_DATE
        description: Date when the listing which originates the event was loaded.
      - name: LAST_MODIFIED_DATE
        description: Date when the event was last modified.
